<script>

  // Shows the loading message, changes its text, and loads a data key.
  ds.setOnValue(function(valuePromise) {
    document.querySelector('.sharable-url').style.display = 'none';
    document.querySelector('.loading-message').style.display = "block";
    document.querySelector('.loading-message').textContent = "Loading geometry...";
    valuePromise.then(window.keyListModule.LoadDataKey);
  });

  // Copy the old projects promise callback so we can still call it while
  // adding some extra functionality.
  ds.selectProject = (function(){
    var oldSelectProjectCallback = ds.selectProject;
    return function(projectId) {
      window.keyListModule.ResetKeyList();
      oldSelectProjectCallback.call(ds, projectId);
    };
  })();

</script>
